"use strict";angular.module("xebiaApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/library.html",controller:"LibraryCtrl"}).when("/cart",{templateUrl:"views/cart.html",controller:"CartCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("xebiaApp").controller("LibraryCtrl",["$scope","$location","apiXebia","Cart",function(a,b,c,d){a.books=[],a.disabled=!1,a.cart=d,a.showCart=function(){b.url("/cart")},c.getBooks.then(function(b){a.books=b.data})}]),angular.module("xebiaApp").factory("apiXebia",["$http",function(a){var b=a.get("http://henri-potier.xebia.fr/books").success(function(a){return a}),c=function(b){return a.get("http://henri-potier.xebia.fr/books/"+b+"/commercialOffers")};return{getBooks:b,getCustomersOrders:c}}]),angular.module("xebiaApp").factory("Cart",["apiXebia",function(a){var b={price:0,nbBooks:0,books:[],offers:[]},c=function(){var c=d(),e=b.price,f=0,g={};b.offers="",""!=c&&a.getCustomersOrders(c).then(function(a){return a.data.offers}).then(function(a){a.forEach(function(a){switch(a.type){case"percentage":var c=b.price*a.value/100;b.price-c<e&&(g=a,f=c,e=b.price-c);break;case"minus":var d=a.value;b.price-d<e&&(g=a,f=d,e=b.price-a.value);break;case"slice":var h=parseInt(b.price/a.sliceValue,10)*a.value;b.price-h<e&&(g=a,f=h,e=b.price*a.value/100)}}),b.offers={bestOffer:e,remise:f,commercialOffer:g}})},d=function(){var a="";return b.books.forEach(function(b){a+=(","+b.isbn).repeat(b.quantity)}),a.substring(1,a.length)};return{getAllCart:function(){return b},addBook:function(a){return b.books.indexOf(a)>=0?b.books[b.books.indexOf(a)].quantity+=1:(b.books.push(a),b.books[b.books.indexOf(a)].quantity=1),b.price+=a.price,b.nbBooks+=1,c(),b},removeBook:function(a){var d=b.books.indexOf(a);return d>=0&&(b.books[d].quantity>1?b.books[b.books.indexOf(a)].quantity-=1:b.books.splice(d,1),b.price-=a.price,b.nbBooks-=1,c()),b},getIsbnAllCart:d,getOffers:function(){return b.offers}}}]),angular.module("xebiaApp").controller("CartCtrl",["$scope","$location","apiXebia","Cart",function(a,b,c,d){var e=d.getAllCart();(0==e.books.length||void 0==e)&&b.url("/about"),a.cart=d,a.showLibrary=function(){b.url("/")}}]);